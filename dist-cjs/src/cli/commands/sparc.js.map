{"version":3,"sources":["../../../../src/cli/commands/sparc.ts"],"sourcesContent":["import { success, error, warning, info } from '../cli-core.js';\nimport type { CommandContext } from '../cli-core.js';\nimport chalk from 'chalk';\nimport {\n  getAgentCoreClient,\n  SPARC_PERSONA_MAP,\n  type PersonaId,\n  type PromptCallbacks,\n} from '../../agent-core/index.js';\n\nconst { blue, yellow, green, magenta, cyan } = chalk;\n\ninterface SparcMode {\n  slug: string;\n  name: string;\n  roleDefinition: string;\n  customInstructions: string;\n  groups: string[];\n  source: string;\n}\n\ninterface SparcConfig {\n  customModes: SparcMode[];\n}\n\nlet sparcConfig: SparcConfig | null = null;\n\n// Default SPARC modes when no .roomodes file exists\nconst defaultSparcModes: SparcMode[] = [\n  {\n    slug: 'spec-pseudocode',\n    name: 'Specification & Pseudocode',\n    roleDefinition: 'Create detailed specifications and pseudocode for the task',\n    customInstructions: 'Focus on clear requirements, edge cases, and algorithmic thinking',\n    groups: ['read', 'edit'],\n    source: 'builtin',\n  },\n  {\n    slug: 'architect',\n    name: 'Architecture Design',\n    roleDefinition: 'Design system architecture and component structure',\n    customInstructions: 'Consider scalability, maintainability, and separation of concerns',\n    groups: ['read', 'edit', 'browser'],\n    source: 'builtin',\n  },\n  {\n    slug: 'code',\n    name: 'Code Implementation',\n    roleDefinition: 'Implement code solutions following best practices',\n    customInstructions: 'Write clean, tested, documented code. Keep files under 500 lines.',\n    groups: ['read', 'edit', 'command'],\n    source: 'builtin',\n  },\n  {\n    slug: 'tdd',\n    name: 'Test-Driven Development',\n    roleDefinition: 'Write tests first, then implement to pass them',\n    customInstructions: 'Follow red-green-refactor cycle. Aim for high test coverage.',\n    groups: ['read', 'edit', 'command'],\n    source: 'builtin',\n  },\n  {\n    slug: 'debug',\n    name: 'Debug & Troubleshoot',\n    roleDefinition: 'Identify and fix issues in code',\n    customInstructions: 'Use systematic debugging approaches. Document root causes.',\n    groups: ['read', 'edit', 'command'],\n    source: 'builtin',\n  },\n  {\n    slug: 'security-review',\n    name: 'Security Review',\n    roleDefinition: 'Analyze code for security vulnerabilities',\n    customInstructions: 'Check for OWASP top 10, input validation, auth issues.',\n    groups: ['read', 'browser'],\n    source: 'builtin',\n  },\n  {\n    slug: 'integration',\n    name: 'Integration',\n    roleDefinition: 'Integrate components and verify complete solution',\n    customInstructions: 'Ensure all parts work together. Run integration tests.',\n    groups: ['read', 'edit', 'command'],\n    source: 'builtin',\n  },\n  {\n    slug: 'refinement-optimization-mode',\n    name: 'Refinement & Optimization',\n    roleDefinition: 'Refactor and optimize existing code',\n    customInstructions: 'Improve performance, readability, and maintainability.',\n    groups: ['read', 'edit', 'command'],\n    source: 'builtin',\n  },\n];\n\nasync function loadSparcConfig(): Promise<SparcConfig> {\n  if (sparcConfig) {\n    return sparcConfig;\n  }\n\n  try {\n    const configPath = '.roomodes';\n    const { readFile } = await import('fs/promises');\n    const content = await readFile(configPath, 'utf-8');\n    sparcConfig = JSON.parse(content);\n    return sparcConfig!;\n  } catch (err) {\n    // If .roomodes doesn't exist, use default modes\n    const isNotFound =\n      err instanceof Error &&\n      (err as NodeJS.ErrnoException).code === 'ENOENT';\n    if (isNotFound) {\n      sparcConfig = { customModes: defaultSparcModes };\n      return sparcConfig;\n    }\n    // For parse errors or other issues, provide helpful message\n    throw new Error(\n      `Failed to load SPARC configuration from .roomodes: ${err instanceof Error ? err.message : String(err)}. ` +\n      `Create a .roomodes file or use default modes.`,\n    );\n  }\n}\n\nexport async function sparcAction(ctx: CommandContext): Promise<void> {\n  const subcommand = ctx.args[0];\n\n  switch (subcommand) {\n    case 'modes':\n      await listSparcModes(ctx);\n      break;\n    case 'info':\n      await showModeInfo(ctx);\n      break;\n    case 'run':\n      await runSparcMode(ctx);\n      break;\n    case 'tdd':\n      await runTddFlow(ctx);\n      break;\n    case 'workflow':\n      await runSparcWorkflow(ctx);\n      break;\n    default:\n      await showSparcHelp();\n      break;\n  }\n}\n\nasync function listSparcModes(ctx: CommandContext): Promise<void> {\n  try {\n    const config = await loadSparcConfig();\n    const verbose = ctx.flags.verbose as boolean;\n\n    success('Available SPARC Modes:');\n    console.log();\n\n    for (const mode of config.customModes) {\n      console.log(`${cyan('‚Ä¢')} ${green(mode.name)} ${blue(`(${mode.slug})`)}`);\n      if (verbose) {\n        console.log(`  ${mode.roleDefinition}`);\n        console.log(`  Tools: ${mode.groups.join(', ')}`);\n        console.log();\n      }\n    }\n\n    if (!verbose) {\n      console.log();\n      info('Use --verbose for detailed descriptions');\n    }\n  } catch (err) {\n    error(`Failed to list SPARC modes: ${(err as Error).message}`);\n  }\n}\n\nasync function showModeInfo(ctx: CommandContext): Promise<void> {\n  const modeSlug = ctx.args[1];\n  if (!modeSlug) {\n    error('Usage: sparc info <mode-slug>');\n    return;\n  }\n\n  try {\n    const config = await loadSparcConfig();\n    const mode = config.customModes.find((m) => m.slug === modeSlug);\n\n    if (!mode) {\n      error(`Mode not found: ${modeSlug}`);\n      console.log('Available modes:');\n      for (const m of config.customModes) {\n        console.log(`  ${m.slug} - ${m.name}`);\n      }\n      return;\n    }\n\n    success(`SPARC Mode: ${mode.name}`);\n    console.log();\n    console.log(blue('Role Definition:'));\n    console.log(mode.roleDefinition);\n    console.log();\n    console.log(blue('Custom Instructions:'));\n    console.log(mode.customInstructions);\n    console.log();\n    console.log(blue('Tool Groups:'));\n    console.log(mode.groups.join(', '));\n    console.log();\n    console.log(blue('Source:'));\n    console.log(mode.source);\n  } catch (err) {\n    error(`Failed to show mode info: ${(err as Error).message}`);\n  }\n}\n\nasync function runSparcMode(ctx: CommandContext): Promise<void> {\n  const modeSlug = ctx.args[1];\n  const taskDescription = ctx.args.slice(2).join(' ');\n\n  if (!modeSlug || !taskDescription) {\n    error('Usage: sparc run <mode-slug> <task-description>');\n    return;\n  }\n\n  try {\n    const config = await loadSparcConfig();\n    const mode = config.customModes.find((m) => m.slug === modeSlug);\n\n    if (!mode) {\n      error(`Mode not found: ${modeSlug}`);\n      return;\n    }\n\n    // Build the enhanced task prompt using SPARC methodology\n    const enhancedTask = buildSparcPrompt(mode, taskDescription, ctx.flags);\n    const instanceId = `sparc-${modeSlug}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n    // Build tools based on mode groups\n    const tools = buildToolsFromGroups(mode.groups);\n\n    if (ctx.flags.dryRun || ctx.flags['dry-run']) {\n      warning('DRY RUN - SPARC Mode Configuration:');\n      console.log(`Mode: ${mode.name} (${mode.slug})`);\n      console.log(`Instance ID: ${instanceId}`);\n      console.log(`Tools: ${tools}`);\n      console.log(`Task: ${taskDescription}`);\n      console.log();\n      console.log('Enhanced prompt preview:');\n      console.log(enhancedTask.substring(0, 300) + '...');\n      return;\n    }\n\n    success(`Starting SPARC mode: ${mode.name}`);\n    console.log(`üìù Instance ID: ${instanceId}`);\n    console.log(`üéØ Mode: ${mode.slug}`);\n    console.log(`üîß Tools: ${tools}`);\n    console.log(`üìã Task: ${taskDescription}`);\n    console.log();\n\n    // Execute via agent-core daemon with persona routing\n    await executeClaudeWithSparc(enhancedTask, tools, instanceId, ctx.flags, mode.slug);\n  } catch (err) {\n    error(`Failed to run SPARC mode: ${(err as Error).message}`);\n  }\n}\n\nasync function runTddFlow(ctx: CommandContext): Promise<void> {\n  const taskDescription = ctx.args.slice(1).join(' ');\n\n  if (!taskDescription) {\n    error('Usage: sparc tdd <task-description>');\n    return;\n  }\n\n  try {\n    const config = await loadSparcConfig();\n\n    // Build TDD workflow using SPARC methodology\n    const workflow = [\n      {\n        mode: 'spec-pseudocode',\n        phase: 'Specification',\n        description: `Create detailed spec and pseudocode for: ${taskDescription}`,\n      },\n      { mode: 'tdd', phase: 'Red', description: `Write failing tests for: ${taskDescription}` },\n      {\n        mode: 'code',\n        phase: 'Green',\n        description: `Implement minimal code to pass tests for: ${taskDescription}`,\n      },\n      {\n        mode: 'refinement-optimization-mode',\n        phase: 'Refactor',\n        description: `Refactor and optimize implementation for: ${taskDescription}`,\n      },\n      {\n        mode: 'integration',\n        phase: 'Integration',\n        description: `Integrate and verify complete solution for: ${taskDescription}`,\n      },\n    ];\n\n    if (ctx.flags.dryRun || ctx.flags['dry-run']) {\n      warning('DRY RUN - TDD Workflow:');\n      for (const step of workflow) {\n        console.log(`${cyan(step.phase)}: ${step.mode} - ${step.description}`);\n      }\n      return;\n    }\n\n    success('Starting SPARC TDD Workflow');\n    console.log('Following Test-Driven Development with SPARC methodology');\n    console.log();\n\n    for (let i = 0; i < workflow.length; i++) {\n      const step = workflow[i];\n      const mode = config.customModes.find((m) => m.slug === step.mode);\n\n      if (!mode) {\n        warning(`Mode not found: ${step.mode}, skipping step`);\n        continue;\n      }\n\n      info(`Phase ${i + 1}/5: ${step.phase} (${mode.name})`);\n      console.log(`üìã ${step.description}`);\n      console.log();\n\n      const enhancedTask = buildSparcPrompt(mode, step.description, {\n        ...ctx.flags,\n        tddPhase: step.phase,\n        workflowStep: i + 1,\n        totalSteps: workflow.length,\n      });\n\n      const tools = buildToolsFromGroups(mode.groups);\n      const instanceId = `sparc-tdd-${step.phase.toLowerCase()}-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`;\n\n      await executeClaudeWithSparc(enhancedTask, tools, instanceId, ctx.flags, step.mode);\n\n      // Store phase completion in memory for next step\n      if (ctx.flags.sequential !== false) {\n        console.log('Phase completed. Press Enter to continue to next phase, or Ctrl+C to stop...');\n        await new Promise<void>(async (resolve) => {\n          const readline = await import('readline');\n          const rl = readline.createInterface({\n            input: process.stdin,\n            output: process.stdout,\n          });\n          rl.question('', () => {\n            rl.close();\n            resolve();\n          });\n        });\n      }\n    }\n\n    success('SPARC TDD Workflow completed!');\n  } catch (err) {\n    error(`Failed to run TDD flow: ${(err as Error).message}`);\n  }\n}\n\nasync function runSparcWorkflow(ctx: CommandContext): Promise<void> {\n  const workflowFile = ctx.args[1];\n\n  if (!workflowFile) {\n    error('Usage: sparc workflow <workflow-file.json>');\n    return;\n  }\n\n  try {\n    const { readFile } = await import('fs/promises');\n    const workflowContent = await readFile(workflowFile, 'utf-8');\n    const workflow = JSON.parse(workflowContent);\n\n    if (!workflow.steps || !Array.isArray(workflow.steps)) {\n      error(\"Invalid workflow file: missing 'steps' array\");\n      return;\n    }\n\n    const config = await loadSparcConfig();\n\n    success(`Loading SPARC workflow: ${workflow.name || 'Unnamed'}`);\n    console.log(`üìã Steps: ${workflow.steps.length}`);\n    console.log(`üìù Description: ${workflow.description || 'No description'}`);\n    console.log();\n\n    if (ctx.flags.dryRun || ctx.flags['dry-run']) {\n      warning('DRY RUN - Workflow Steps:');\n      for (let i = 0; i < workflow.steps.length; i++) {\n        const step = workflow.steps[i];\n        console.log(`${i + 1}. ${cyan(step.mode)} - ${step.description || step.task}`);\n      }\n      return;\n    }\n\n    for (let i = 0; i < workflow.steps.length; i++) {\n      const step = workflow.steps[i];\n      const mode = config.customModes.find((m) => m.slug === step.mode);\n\n      if (!mode) {\n        warning(`Mode not found: ${step.mode}, skipping step ${i + 1}`);\n        continue;\n      }\n\n      info(`Step ${i + 1}/${workflow.steps.length}: ${mode.name}`);\n      console.log(`üìã ${step.description || step.task}`);\n      console.log();\n\n      const enhancedTask = buildSparcPrompt(mode, step.description || step.task, {\n        ...ctx.flags,\n        workflowStep: i + 1,\n        totalSteps: workflow.steps.length,\n        workflowName: workflow.name,\n      });\n\n      const tools = buildToolsFromGroups(mode.groups);\n      const instanceId = `sparc-workflow-${i + 1}-${Date.now()}-${Math.random().toString(36).substr(2, 5)}`;\n\n      await executeClaudeWithSparc(enhancedTask, tools, instanceId, ctx.flags, step.mode);\n\n      if (workflow.sequential !== false && i < workflow.steps.length - 1) {\n        console.log('Step completed. Press Enter to continue, or Ctrl+C to stop...');\n        await new Promise<void>((resolve) => {\n          const readline = require('readline');\n          const rl = readline.createInterface({\n            input: process.stdin,\n            output: process.stdout,\n          });\n          rl.question('', () => {\n            rl.close();\n            resolve();\n          });\n        });\n      }\n    }\n\n    success('SPARC workflow completed!');\n  } catch (err) {\n    error(`Failed to run workflow: ${(err as Error).message}`);\n  }\n}\n\nfunction buildSparcPrompt(mode: SparcMode, taskDescription: string, flags: any): string {\n  const memoryNamespace = flags.namespace || mode.slug || 'default';\n\n  return `# SPARC Development Mode: ${mode.name}\n\n## Your Role\n${mode.roleDefinition}\n\n## Your Task\n${taskDescription}\n\n## Mode-Specific Instructions\n${mode.customInstructions}\n\n## SPARC Development Environment\n\nYou are working within the SPARC (Specification, Pseudocode, Architecture, Refinement, Completion) methodology using claude-flow orchestration features.\n\n### Available Development Tools\n- **Memory Persistence**: Use \\`npx claude-flow memory store <key> \"<value>\"\\` to save progress and findings\n- **Memory Retrieval**: Use \\`npx claude-flow memory query <search>\\` to access previous work\n- **Namespace**: Your work is stored in the \"${memoryNamespace}\" namespace\n\n### SPARC Methodology Integration\n${\n  flags.tddPhase\n    ? `\n**Current TDD Phase**: ${flags.tddPhase}\n- Follow the Red-Green-Refactor cycle\n- Store test results and refactoring notes in memory\n`\n    : ''\n}\n\n${\n  flags.workflowStep\n    ? `\n**Workflow Progress**: Step ${flags.workflowStep} of ${flags.totalSteps}\n- Review previous steps: \\`npx claude-flow memory query previous_steps\\`\n- Store this step's output: \\`npx claude-flow memory store step_${flags.workflowStep}_output \"<results>\"\\`\n`\n    : ''\n}\n\n### Best Practices\n1. **Modular Development**: Keep all files under 500 lines\n2. **Environment Safety**: Never hardcode secrets or environment values\n3. **Memory Usage**: Store key findings and decisions in memory for future reference\n4. **Tool Integration**: Use \\`new_task\\` for subtasks and \\`attempt_completion\\` when finished\n\n### Memory Commands Examples\n\\`\\`\\`bash\n# Store your progress\nnpx claude-flow memory store ${memoryNamespace}_progress \"Current status and findings\"\n\n# Check for previous work\nnpx claude-flow memory query ${memoryNamespace}\n\n# Store phase-specific results\nnpx claude-flow memory store ${memoryNamespace}_${flags.tddPhase || 'results'} \"Phase output and decisions\"\n\\`\\`\\`\n\n### Integration with Other SPARC Modes\nWhen working with other SPARC modes, use memory to:\n- Share findings with spec-pseudocode mode\n- Pass requirements to architect mode  \n- Coordinate with code and tdd modes\n- Communicate results to integration mode\n\nNow proceed with your task following the SPARC methodology and your specific role instructions.`;\n}\n\nfunction buildToolsFromGroups(groups: string[]): string {\n  const toolMappings: Record<string, string[]> = {\n    read: ['View', 'LS', 'GlobTool', 'GrepTool'],\n    edit: ['Edit', 'Replace', 'MultiEdit', 'Write'],\n    browser: ['WebFetch'],\n    mcp: ['mcp_tools'],\n    command: ['Bash', 'Terminal'],\n  };\n\n  const tools = new Set<string>();\n\n  // Always include basic tools\n  tools.add('View');\n  tools.add('Edit');\n  tools.add('Bash');\n\n  for (const group of groups) {\n    if (Array.isArray(group)) {\n      // Handle nested group definitions\n      const groupName = group[0];\n      if (toolMappings[groupName]) {\n        toolMappings[groupName].forEach((tool) => tools.add(tool));\n      }\n    } else if (toolMappings[group]) {\n      toolMappings[group].forEach((tool) => tools.add(tool));\n    }\n  }\n\n  return Array.from(tools).join(',');\n}\n\nasync function executeClaudeWithSparc(\n  enhancedTask: string,\n  _tools: string,\n  instanceId: string,\n  flags: any,\n  modeSlug?: string,\n): Promise<void> {\n  // Determine persona based on SPARC mode\n  const persona: PersonaId = modeSlug\n    ? SPARC_PERSONA_MAP[modeSlug] ?? SPARC_PERSONA_MAP['default']\n    : SPARC_PERSONA_MAP['default'];\n\n  try {\n    const client = getAgentCoreClient();\n\n    // Ensure daemon is running\n    await client.ensureConnected();\n\n    // Create session for this SPARC execution\n    const session = await client.createSession({\n      title: instanceId,\n    });\n\n    info(`Routing to persona: ${persona}`);\n    if (flags.verbose) {\n      console.log(`Session ID: ${session.id}`);\n      console.log(`Mode: ${modeSlug ?? 'default'}`);\n    }\n\n    // Set up callbacks for streaming output\n    const callbacks: PromptCallbacks = {\n      onText: (text) => process.stdout.write(text),\n      onReasoning: (text) => {\n        if (flags.verbose) {\n          console.log(chalk.dim(`[reasoning] ${text}`));\n        }\n      },\n      onToolStart: (tool) => {\n        if (flags.verbose) {\n          console.log(chalk.cyan(`[tool] ${tool}...`));\n        }\n      },\n      onToolEnd: (tool, result) => {\n        if (flags.verbose) {\n          console.log(chalk.green(`[tool] ${tool} completed`));\n        }\n      },\n      onError: (err) => {\n        error(`Error: ${err.message}`);\n      },\n    };\n\n    // Execute via daemon API\n    const result = await client.prompt(\n      {\n        sessionId: session.id,\n        prompt: enhancedTask,\n        persona,\n      },\n      callbacks\n    );\n\n    // Cleanup session\n    try {\n      await client.deleteSession(session.id);\n    } catch {\n      // Ignore cleanup errors\n    }\n\n    if (result.success) {\n      console.log(); // Newline after streamed output\n      success(`SPARC instance ${instanceId} completed successfully`);\n      if (flags.verbose && result.tokenCount > 0) {\n        info(`Tokens used: ${result.tokenCount}`);\n      }\n    } else {\n      error(`SPARC instance ${instanceId} failed: ${result.error ?? 'Unknown error'}`);\n    }\n  } catch (err) {\n    const message = err instanceof Error ? err.message : String(err);\n    if (message.includes('daemon not running')) {\n      error(`agent-core daemon not running. Start it with:`);\n      console.log(chalk.yellow('  agent-core daemon --external-gateway'));\n    } else {\n      error(`Failed to execute SPARC mode: ${message}`);\n    }\n  }\n}\n\nasync function showSparcHelp(): Promise<void> {\n  console.log(\n    `${cyan('SPARC')} - ${green('Specification, Pseudocode, Architecture, Refinement, Completion')}`,\n  );\n  console.log();\n  console.log('SPARC development methodology with TDD and multi-agent coordination.');\n  console.log();\n  console.log(blue('Commands:'));\n  console.log('  modes                    List all available SPARC modes');\n  console.log('  info <mode>              Show detailed information about a mode');\n  console.log('  run <mode> <task>        Execute a task using a specific SPARC mode');\n  console.log('  tdd <task>               Run full TDD workflow using SPARC methodology');\n  console.log('  workflow <file>          Execute a custom SPARC workflow from JSON file');\n  console.log();\n  console.log(blue('Common Modes:'));\n  console.log('  spec-pseudocode          Create specifications and pseudocode');\n  console.log('  architect                Design system architecture');\n  console.log('  code                     Implement code solutions');\n  console.log('  tdd                      Test-driven development');\n  console.log('  debug                    Debug and troubleshoot issues');\n  console.log('  security-review          Security analysis and review');\n  console.log('  docs-writer              Documentation creation');\n  console.log('  integration              System integration and testing');\n  console.log();\n  console.log(blue('Options:'));\n  console.log('  --namespace <ns>         Memory namespace for this session');\n  console.log('  --no-permissions         Skip permission prompts');\n  console.log('  --config <file>          MCP configuration file');\n  console.log('  --verbose               Enable verbose output');\n  console.log('  --dry-run               Preview what would be executed');\n  console.log('  --sequential            Wait between workflow steps (default: true)');\n  console.log();\n  console.log(blue('Examples:'));\n  console.log(\n    `  ${yellow('claude-flow sparc modes')}                              # List all modes`,\n  );\n  console.log(\n    `  ${yellow('claude-flow sparc run code')} \"implement user auth\"      # Run specific mode`,\n  );\n  console.log(\n    `  ${yellow('claude-flow sparc tdd')} \"payment processing system\"    # Full TDD workflow`,\n  );\n  console.log(\n    `  ${yellow('claude-flow sparc workflow')} project-workflow.json     # Custom workflow`,\n  );\n  console.log();\n  console.log(blue('TDD Workflow:'));\n  console.log('  1. Specification - Define requirements and create pseudocode');\n  console.log('  2. Red Phase - Write failing tests');\n  console.log('  3. Green Phase - Implement minimal code to pass tests');\n  console.log('  4. Refactor Phase - Optimize and clean up code');\n  console.log('  5. Integration - Verify complete solution');\n  console.log();\n  console.log('For more information: https://github.com/ruvnet/claude-code-flow/docs/sparc.md');\n}\n"],"names":["success","error","warning","info","chalk","getAgentCoreClient","SPARC_PERSONA_MAP","blue","yellow","green","magenta","cyan","sparcConfig","defaultSparcModes","slug","name","roleDefinition","customInstructions","groups","source","loadSparcConfig","configPath","readFile","content","JSON","parse","err","isNotFound","Error","code","customModes","message","String","sparcAction","ctx","subcommand","args","listSparcModes","showModeInfo","runSparcMode","runTddFlow","runSparcWorkflow","showSparcHelp","config","verbose","flags","console","log","mode","join","modeSlug","find","m","taskDescription","slice","enhancedTask","buildSparcPrompt","instanceId","Date","now","Math","random","toString","substr","tools","buildToolsFromGroups","dryRun","substring","executeClaudeWithSparc","workflow","phase","description","step","i","length","tddPhase","workflowStep","totalSteps","toLowerCase","sequential","Promise","resolve","readline","rl","createInterface","input","process","stdin","output","stdout","question","close","workflowFile","workflowContent","steps","Array","isArray","task","workflowName","require","memoryNamespace","namespace","toolMappings","read","edit","browser","mcp","command","Set","add","group","groupName","forEach","tool","from","_tools","persona","client","ensureConnected","session","createSession","title","id","callbacks","onText","text","write","onReasoning","dim","onToolStart","onToolEnd","result","onError","prompt","sessionId","deleteSession","tokenCount","includes"],"mappings":"AAAA,SAASA,OAAO,EAAEC,KAAK,EAAEC,OAAO,EAAEC,IAAI,QAAQ,iBAAiB;AAE/D,OAAOC,WAAW,QAAQ;AAC1B,SACEC,kBAAkB,EAClBC,iBAAiB,QAGZ,4BAA4B;AAEnC,MAAM,EAAEC,IAAI,EAAEC,MAAM,EAAEC,KAAK,EAAEC,OAAO,EAAEC,IAAI,EAAE,GAAGP;AAe/C,IAAIQ,cAAkC;AAGtC,MAAMC,oBAAiC;IACrC;QACEC,MAAM;QACNC,MAAM;QACNC,gBAAgB;QAChBC,oBAAoB;QACpBC,QAAQ;YAAC;YAAQ;SAAO;QACxBC,QAAQ;IACV;IACA;QACEL,MAAM;QACNC,MAAM;QACNC,gBAAgB;QAChBC,oBAAoB;QACpBC,QAAQ;YAAC;YAAQ;YAAQ;SAAU;QACnCC,QAAQ;IACV;IACA;QACEL,MAAM;QACNC,MAAM;QACNC,gBAAgB;QAChBC,oBAAoB;QACpBC,QAAQ;YAAC;YAAQ;YAAQ;SAAU;QACnCC,QAAQ;IACV;IACA;QACEL,MAAM;QACNC,MAAM;QACNC,gBAAgB;QAChBC,oBAAoB;QACpBC,QAAQ;YAAC;YAAQ;YAAQ;SAAU;QACnCC,QAAQ;IACV;IACA;QACEL,MAAM;QACNC,MAAM;QACNC,gBAAgB;QAChBC,oBAAoB;QACpBC,QAAQ;YAAC;YAAQ;YAAQ;SAAU;QACnCC,QAAQ;IACV;IACA;QACEL,MAAM;QACNC,MAAM;QACNC,gBAAgB;QAChBC,oBAAoB;QACpBC,QAAQ;YAAC;YAAQ;SAAU;QAC3BC,QAAQ;IACV;IACA;QACEL,MAAM;QACNC,MAAM;QACNC,gBAAgB;QAChBC,oBAAoB;QACpBC,QAAQ;YAAC;YAAQ;YAAQ;SAAU;QACnCC,QAAQ;IACV;IACA;QACEL,MAAM;QACNC,MAAM;QACNC,gBAAgB;QAChBC,oBAAoB;QACpBC,QAAQ;YAAC;YAAQ;YAAQ;SAAU;QACnCC,QAAQ;IACV;CACD;AAED,eAAeC;IACb,IAAIR,aAAa;QACf,OAAOA;IACT;IAEA,IAAI;QACF,MAAMS,aAAa;QACnB,MAAM,EAAEC,QAAQ,EAAE,GAAG,MAAM,MAAM,CAAC;QAClC,MAAMC,UAAU,MAAMD,SAASD,YAAY;QAC3CT,cAAcY,KAAKC,KAAK,CAACF;QACzB,OAAOX;IACT,EAAE,OAAOc,KAAK;QAEZ,MAAMC,aACJD,eAAeE,SACf,AAACF,IAA8BG,IAAI,KAAK;QAC1C,IAAIF,YAAY;YACdf,cAAc;gBAAEkB,aAAajB;YAAkB;YAC/C,OAAOD;QACT;QAEA,MAAM,IAAIgB,MACR,CAAC,mDAAmD,EAAEF,eAAeE,QAAQF,IAAIK,OAAO,GAAGC,OAAON,KAAK,EAAE,CAAC,GAC1G,CAAC,6CAA6C,CAAC;IAEnD;AACF;AAEA,OAAO,eAAeO,YAAYC,GAAmB;IACnD,MAAMC,aAAaD,IAAIE,IAAI,CAAC,EAAE;IAE9B,OAAQD;QACN,KAAK;YACH,MAAME,eAAeH;YACrB;QACF,KAAK;YACH,MAAMI,aAAaJ;YACnB;QACF,KAAK;YACH,MAAMK,aAAaL;YACnB;QACF,KAAK;YACH,MAAMM,WAAWN;YACjB;QACF,KAAK;YACH,MAAMO,iBAAiBP;YACvB;QACF;YACE,MAAMQ;YACN;IACJ;AACF;AAEA,eAAeL,eAAeH,GAAmB;IAC/C,IAAI;QACF,MAAMS,SAAS,MAAMvB;QACrB,MAAMwB,UAAUV,IAAIW,KAAK,CAACD,OAAO;QAEjC5C,QAAQ;QACR8C,QAAQC,GAAG;QAEX,KAAK,MAAMC,QAAQL,OAAOb,WAAW,CAAE;YACrCgB,QAAQC,GAAG,CAAC,GAAGpC,KAAK,KAAK,CAAC,EAAEF,MAAMuC,KAAKjC,IAAI,EAAE,CAAC,EAAER,KAAK,CAAC,CAAC,EAAEyC,KAAKlC,IAAI,CAAC,CAAC,CAAC,GAAG;YACxE,IAAI8B,SAAS;gBACXE,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEC,KAAKhC,cAAc,EAAE;gBACtC8B,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEC,KAAK9B,MAAM,CAAC+B,IAAI,CAAC,OAAO;gBAChDH,QAAQC,GAAG;YACb;QACF;QAEA,IAAI,CAACH,SAAS;YACZE,QAAQC,GAAG;YACX5C,KAAK;QACP;IACF,EAAE,OAAOuB,KAAK;QACZzB,MAAM,CAAC,4BAA4B,EAAE,AAACyB,IAAcK,OAAO,EAAE;IAC/D;AACF;AAEA,eAAeO,aAAaJ,GAAmB;IAC7C,MAAMgB,WAAWhB,IAAIE,IAAI,CAAC,EAAE;IAC5B,IAAI,CAACc,UAAU;QACbjD,MAAM;QACN;IACF;IAEA,IAAI;QACF,MAAM0C,SAAS,MAAMvB;QACrB,MAAM4B,OAAOL,OAAOb,WAAW,CAACqB,IAAI,CAAC,CAACC,IAAMA,EAAEtC,IAAI,KAAKoC;QAEvD,IAAI,CAACF,MAAM;YACT/C,MAAM,CAAC,gBAAgB,EAAEiD,UAAU;YACnCJ,QAAQC,GAAG,CAAC;YACZ,KAAK,MAAMK,KAAKT,OAAOb,WAAW,CAAE;gBAClCgB,QAAQC,GAAG,CAAC,CAAC,EAAE,EAAEK,EAAEtC,IAAI,CAAC,GAAG,EAAEsC,EAAErC,IAAI,EAAE;YACvC;YACA;QACF;QAEAf,QAAQ,CAAC,YAAY,EAAEgD,KAAKjC,IAAI,EAAE;QAClC+B,QAAQC,GAAG;QACXD,QAAQC,GAAG,CAACxC,KAAK;QACjBuC,QAAQC,GAAG,CAACC,KAAKhC,cAAc;QAC/B8B,QAAQC,GAAG;QACXD,QAAQC,GAAG,CAACxC,KAAK;QACjBuC,QAAQC,GAAG,CAACC,KAAK/B,kBAAkB;QACnC6B,QAAQC,GAAG;QACXD,QAAQC,GAAG,CAACxC,KAAK;QACjBuC,QAAQC,GAAG,CAACC,KAAK9B,MAAM,CAAC+B,IAAI,CAAC;QAC7BH,QAAQC,GAAG;QACXD,QAAQC,GAAG,CAACxC,KAAK;QACjBuC,QAAQC,GAAG,CAACC,KAAK7B,MAAM;IACzB,EAAE,OAAOO,KAAK;QACZzB,MAAM,CAAC,0BAA0B,EAAE,AAACyB,IAAcK,OAAO,EAAE;IAC7D;AACF;AAEA,eAAeQ,aAAaL,GAAmB;IAC7C,MAAMgB,WAAWhB,IAAIE,IAAI,CAAC,EAAE;IAC5B,MAAMiB,kBAAkBnB,IAAIE,IAAI,CAACkB,KAAK,CAAC,GAAGL,IAAI,CAAC;IAE/C,IAAI,CAACC,YAAY,CAACG,iBAAiB;QACjCpD,MAAM;QACN;IACF;IAEA,IAAI;QACF,MAAM0C,SAAS,MAAMvB;QACrB,MAAM4B,OAAOL,OAAOb,WAAW,CAACqB,IAAI,CAAC,CAACC,IAAMA,EAAEtC,IAAI,KAAKoC;QAEvD,IAAI,CAACF,MAAM;YACT/C,MAAM,CAAC,gBAAgB,EAAEiD,UAAU;YACnC;QACF;QAGA,MAAMK,eAAeC,iBAAiBR,MAAMK,iBAAiBnB,IAAIW,KAAK;QACtE,MAAMY,aAAa,CAAC,MAAM,EAAEP,SAAS,CAAC,EAAEQ,KAAKC,GAAG,GAAG,CAAC,EAAEC,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;QAG/F,MAAMC,QAAQC,qBAAqBjB,KAAK9B,MAAM;QAE9C,IAAIgB,IAAIW,KAAK,CAACqB,MAAM,IAAIhC,IAAIW,KAAK,CAAC,UAAU,EAAE;YAC5C3C,QAAQ;YACR4C,QAAQC,GAAG,CAAC,CAAC,MAAM,EAAEC,KAAKjC,IAAI,CAAC,EAAE,EAAEiC,KAAKlC,IAAI,CAAC,CAAC,CAAC;YAC/CgC,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAEU,YAAY;YACxCX,QAAQC,GAAG,CAAC,CAAC,OAAO,EAAEiB,OAAO;YAC7BlB,QAAQC,GAAG,CAAC,CAAC,MAAM,EAAEM,iBAAiB;YACtCP,QAAQC,GAAG;YACXD,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAACQ,aAAaY,SAAS,CAAC,GAAG,OAAO;YAC7C;QACF;QAEAnE,QAAQ,CAAC,qBAAqB,EAAEgD,KAAKjC,IAAI,EAAE;QAC3C+B,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEU,YAAY;QAC3CX,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEC,KAAKlC,IAAI,EAAE;QACnCgC,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEiB,OAAO;QAChClB,QAAQC,GAAG,CAAC,CAAC,SAAS,EAAEM,iBAAiB;QACzCP,QAAQC,GAAG;QAGX,MAAMqB,uBAAuBb,cAAcS,OAAOP,YAAYvB,IAAIW,KAAK,EAAEG,KAAKlC,IAAI;IACpF,EAAE,OAAOY,KAAK;QACZzB,MAAM,CAAC,0BAA0B,EAAE,AAACyB,IAAcK,OAAO,EAAE;IAC7D;AACF;AAEA,eAAeS,WAAWN,GAAmB;IAC3C,MAAMmB,kBAAkBnB,IAAIE,IAAI,CAACkB,KAAK,CAAC,GAAGL,IAAI,CAAC;IAE/C,IAAI,CAACI,iBAAiB;QACpBpD,MAAM;QACN;IACF;IAEA,IAAI;QACF,MAAM0C,SAAS,MAAMvB;QAGrB,MAAMiD,WAAW;YACf;gBACErB,MAAM;gBACNsB,OAAO;gBACPC,aAAa,CAAC,yCAAyC,EAAElB,iBAAiB;YAC5E;YACA;gBAAEL,MAAM;gBAAOsB,OAAO;gBAAOC,aAAa,CAAC,yBAAyB,EAAElB,iBAAiB;YAAC;YACxF;gBACEL,MAAM;gBACNsB,OAAO;gBACPC,aAAa,CAAC,0CAA0C,EAAElB,iBAAiB;YAC7E;YACA;gBACEL,MAAM;gBACNsB,OAAO;gBACPC,aAAa,CAAC,0CAA0C,EAAElB,iBAAiB;YAC7E;YACA;gBACEL,MAAM;gBACNsB,OAAO;gBACPC,aAAa,CAAC,4CAA4C,EAAElB,iBAAiB;YAC/E;SACD;QAED,IAAInB,IAAIW,KAAK,CAACqB,MAAM,IAAIhC,IAAIW,KAAK,CAAC,UAAU,EAAE;YAC5C3C,QAAQ;YACR,KAAK,MAAMsE,QAAQH,SAAU;gBAC3BvB,QAAQC,GAAG,CAAC,GAAGpC,KAAK6D,KAAKF,KAAK,EAAE,EAAE,EAAEE,KAAKxB,IAAI,CAAC,GAAG,EAAEwB,KAAKD,WAAW,EAAE;YACvE;YACA;QACF;QAEAvE,QAAQ;QACR8C,QAAQC,GAAG,CAAC;QACZD,QAAQC,GAAG;QAEX,IAAK,IAAI0B,IAAI,GAAGA,IAAIJ,SAASK,MAAM,EAAED,IAAK;YACxC,MAAMD,OAAOH,QAAQ,CAACI,EAAE;YACxB,MAAMzB,OAAOL,OAAOb,WAAW,CAACqB,IAAI,CAAC,CAACC,IAAMA,EAAEtC,IAAI,KAAK0D,KAAKxB,IAAI;YAEhE,IAAI,CAACA,MAAM;gBACT9C,QAAQ,CAAC,gBAAgB,EAAEsE,KAAKxB,IAAI,CAAC,eAAe,CAAC;gBACrD;YACF;YAEA7C,KAAK,CAAC,MAAM,EAAEsE,IAAI,EAAE,IAAI,EAAED,KAAKF,KAAK,CAAC,EAAE,EAAEtB,KAAKjC,IAAI,CAAC,CAAC,CAAC;YACrD+B,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEyB,KAAKD,WAAW,EAAE;YACpCzB,QAAQC,GAAG;YAEX,MAAMQ,eAAeC,iBAAiBR,MAAMwB,KAAKD,WAAW,EAAE;gBAC5D,GAAGrC,IAAIW,KAAK;gBACZ8B,UAAUH,KAAKF,KAAK;gBACpBM,cAAcH,IAAI;gBAClBI,YAAYR,SAASK,MAAM;YAC7B;YAEA,MAAMV,QAAQC,qBAAqBjB,KAAK9B,MAAM;YAC9C,MAAMuC,aAAa,CAAC,UAAU,EAAEe,KAAKF,KAAK,CAACQ,WAAW,GAAG,CAAC,EAAEpB,KAAKC,GAAG,GAAG,CAAC,EAAEC,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;YAEnH,MAAMK,uBAAuBb,cAAcS,OAAOP,YAAYvB,IAAIW,KAAK,EAAE2B,KAAKxB,IAAI;YAGlF,IAAId,IAAIW,KAAK,CAACkC,UAAU,KAAK,OAAO;gBAClCjC,QAAQC,GAAG,CAAC;gBACZ,MAAM,IAAIiC,QAAc,OAAOC;oBAC7B,MAAMC,WAAW,MAAM,MAAM,CAAC;oBAC9B,MAAMC,KAAKD,SAASE,eAAe,CAAC;wBAClCC,OAAOC,QAAQC,KAAK;wBACpBC,QAAQF,QAAQG,MAAM;oBACxB;oBACAN,GAAGO,QAAQ,CAAC,IAAI;wBACdP,GAAGQ,KAAK;wBACRV;oBACF;gBACF;YACF;QACF;QAEAjF,QAAQ;IACV,EAAE,OAAO0B,KAAK;QACZzB,MAAM,CAAC,wBAAwB,EAAE,AAACyB,IAAcK,OAAO,EAAE;IAC3D;AACF;AAEA,eAAeU,iBAAiBP,GAAmB;IACjD,MAAM0D,eAAe1D,IAAIE,IAAI,CAAC,EAAE;IAEhC,IAAI,CAACwD,cAAc;QACjB3F,MAAM;QACN;IACF;IAEA,IAAI;QACF,MAAM,EAAEqB,QAAQ,EAAE,GAAG,MAAM,MAAM,CAAC;QAClC,MAAMuE,kBAAkB,MAAMvE,SAASsE,cAAc;QACrD,MAAMvB,WAAW7C,KAAKC,KAAK,CAACoE;QAE5B,IAAI,CAACxB,SAASyB,KAAK,IAAI,CAACC,MAAMC,OAAO,CAAC3B,SAASyB,KAAK,GAAG;YACrD7F,MAAM;YACN;QACF;QAEA,MAAM0C,SAAS,MAAMvB;QAErBpB,QAAQ,CAAC,wBAAwB,EAAEqE,SAAStD,IAAI,IAAI,WAAW;QAC/D+B,QAAQC,GAAG,CAAC,CAAC,UAAU,EAAEsB,SAASyB,KAAK,CAACpB,MAAM,EAAE;QAChD5B,QAAQC,GAAG,CAAC,CAAC,gBAAgB,EAAEsB,SAASE,WAAW,IAAI,kBAAkB;QACzEzB,QAAQC,GAAG;QAEX,IAAIb,IAAIW,KAAK,CAACqB,MAAM,IAAIhC,IAAIW,KAAK,CAAC,UAAU,EAAE;YAC5C3C,QAAQ;YACR,IAAK,IAAIuE,IAAI,GAAGA,IAAIJ,SAASyB,KAAK,CAACpB,MAAM,EAAED,IAAK;gBAC9C,MAAMD,OAAOH,SAASyB,KAAK,CAACrB,EAAE;gBAC9B3B,QAAQC,GAAG,CAAC,GAAG0B,IAAI,EAAE,EAAE,EAAE9D,KAAK6D,KAAKxB,IAAI,EAAE,GAAG,EAAEwB,KAAKD,WAAW,IAAIC,KAAKyB,IAAI,EAAE;YAC/E;YACA;QACF;QAEA,IAAK,IAAIxB,IAAI,GAAGA,IAAIJ,SAASyB,KAAK,CAACpB,MAAM,EAAED,IAAK;YAC9C,MAAMD,OAAOH,SAASyB,KAAK,CAACrB,EAAE;YAC9B,MAAMzB,OAAOL,OAAOb,WAAW,CAACqB,IAAI,CAAC,CAACC,IAAMA,EAAEtC,IAAI,KAAK0D,KAAKxB,IAAI;YAEhE,IAAI,CAACA,MAAM;gBACT9C,QAAQ,CAAC,gBAAgB,EAAEsE,KAAKxB,IAAI,CAAC,gBAAgB,EAAEyB,IAAI,GAAG;gBAC9D;YACF;YAEAtE,KAAK,CAAC,KAAK,EAAEsE,IAAI,EAAE,CAAC,EAAEJ,SAASyB,KAAK,CAACpB,MAAM,CAAC,EAAE,EAAE1B,KAAKjC,IAAI,EAAE;YAC3D+B,QAAQC,GAAG,CAAC,CAAC,GAAG,EAAEyB,KAAKD,WAAW,IAAIC,KAAKyB,IAAI,EAAE;YACjDnD,QAAQC,GAAG;YAEX,MAAMQ,eAAeC,iBAAiBR,MAAMwB,KAAKD,WAAW,IAAIC,KAAKyB,IAAI,EAAE;gBACzE,GAAG/D,IAAIW,KAAK;gBACZ+B,cAAcH,IAAI;gBAClBI,YAAYR,SAASyB,KAAK,CAACpB,MAAM;gBACjCwB,cAAc7B,SAAStD,IAAI;YAC7B;YAEA,MAAMiD,QAAQC,qBAAqBjB,KAAK9B,MAAM;YAC9C,MAAMuC,aAAa,CAAC,eAAe,EAAEgB,IAAI,EAAE,CAAC,EAAEf,KAAKC,GAAG,GAAG,CAAC,EAAEC,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,MAAM,CAAC,GAAG,IAAI;YAErG,MAAMK,uBAAuBb,cAAcS,OAAOP,YAAYvB,IAAIW,KAAK,EAAE2B,KAAKxB,IAAI;YAElF,IAAIqB,SAASU,UAAU,KAAK,SAASN,IAAIJ,SAASyB,KAAK,CAACpB,MAAM,GAAG,GAAG;gBAClE5B,QAAQC,GAAG,CAAC;gBACZ,MAAM,IAAIiC,QAAc,CAACC;oBACvB,MAAMC,WAAWiB,QAAQ;oBACzB,MAAMhB,KAAKD,SAASE,eAAe,CAAC;wBAClCC,OAAOC,QAAQC,KAAK;wBACpBC,QAAQF,QAAQG,MAAM;oBACxB;oBACAN,GAAGO,QAAQ,CAAC,IAAI;wBACdP,GAAGQ,KAAK;wBACRV;oBACF;gBACF;YACF;QACF;QAEAjF,QAAQ;IACV,EAAE,OAAO0B,KAAK;QACZzB,MAAM,CAAC,wBAAwB,EAAE,AAACyB,IAAcK,OAAO,EAAE;IAC3D;AACF;AAEA,SAASyB,iBAAiBR,IAAe,EAAEK,eAAuB,EAAER,KAAU;IAC5E,MAAMuD,kBAAkBvD,MAAMwD,SAAS,IAAIrD,KAAKlC,IAAI,IAAI;IAExD,OAAO,CAAC,0BAA0B,EAAEkC,KAAKjC,IAAI,CAAC;;;AAGhD,EAAEiC,KAAKhC,cAAc,CAAC;;;AAGtB,EAAEqC,gBAAgB;;;AAGlB,EAAEL,KAAK/B,kBAAkB,CAAC;;;;;;;;;6CASmB,EAAEmF,gBAAgB;;;AAG/D,EACEvD,MAAM8B,QAAQ,GACV,CAAC;uBACgB,EAAE9B,MAAM8B,QAAQ,CAAC;;;AAGxC,CAAC,GACK,GACL;;AAED,EACE9B,MAAM+B,YAAY,GACd,CAAC;4BACqB,EAAE/B,MAAM+B,YAAY,CAAC,IAAI,EAAE/B,MAAMgC,UAAU,CAAC;;gEAER,EAAEhC,MAAM+B,YAAY,CAAC;AACrF,CAAC,GACK,GACL;;;;;;;;;;;6BAW4B,EAAEwB,gBAAgB;;;6BAGlB,EAAEA,gBAAgB;;;6BAGlB,EAAEA,gBAAgB,CAAC,EAAEvD,MAAM8B,QAAQ,IAAI,UAAU;;;;;;;;;;+FAUiB,CAAC;AAChG;AAEA,SAASV,qBAAqB/C,MAAgB;IAC5C,MAAMoF,eAAyC;QAC7CC,MAAM;YAAC;YAAQ;YAAM;YAAY;SAAW;QAC5CC,MAAM;YAAC;YAAQ;YAAW;YAAa;SAAQ;QAC/CC,SAAS;YAAC;SAAW;QACrBC,KAAK;YAAC;SAAY;QAClBC,SAAS;YAAC;YAAQ;SAAW;IAC/B;IAEA,MAAM3C,QAAQ,IAAI4C;IAGlB5C,MAAM6C,GAAG,CAAC;IACV7C,MAAM6C,GAAG,CAAC;IACV7C,MAAM6C,GAAG,CAAC;IAEV,KAAK,MAAMC,SAAS5F,OAAQ;QAC1B,IAAI6E,MAAMC,OAAO,CAACc,QAAQ;YAExB,MAAMC,YAAYD,KAAK,CAAC,EAAE;YAC1B,IAAIR,YAAY,CAACS,UAAU,EAAE;gBAC3BT,YAAY,CAACS,UAAU,CAACC,OAAO,CAAC,CAACC,OAASjD,MAAM6C,GAAG,CAACI;YACtD;QACF,OAAO,IAAIX,YAAY,CAACQ,MAAM,EAAE;YAC9BR,YAAY,CAACQ,MAAM,CAACE,OAAO,CAAC,CAACC,OAASjD,MAAM6C,GAAG,CAACI;QAClD;IACF;IAEA,OAAOlB,MAAMmB,IAAI,CAAClD,OAAOf,IAAI,CAAC;AAChC;AAEA,eAAemB,uBACbb,YAAoB,EACpB4D,MAAc,EACd1D,UAAkB,EAClBZ,KAAU,EACVK,QAAiB;IAGjB,MAAMkE,UAAqBlE,WACvB5C,iBAAiB,CAAC4C,SAAS,IAAI5C,iBAAiB,CAAC,UAAU,GAC3DA,iBAAiB,CAAC,UAAU;IAEhC,IAAI;QACF,MAAM+G,SAAShH;QAGf,MAAMgH,OAAOC,eAAe;QAG5B,MAAMC,UAAU,MAAMF,OAAOG,aAAa,CAAC;YACzCC,OAAOhE;QACT;QAEAtD,KAAK,CAAC,oBAAoB,EAAEiH,SAAS;QACrC,IAAIvE,MAAMD,OAAO,EAAE;YACjBE,QAAQC,GAAG,CAAC,CAAC,YAAY,EAAEwE,QAAQG,EAAE,EAAE;YACvC5E,QAAQC,GAAG,CAAC,CAAC,MAAM,EAAEG,YAAY,WAAW;QAC9C;QAGA,MAAMyE,YAA6B;YACjCC,QAAQ,CAACC,OAASvC,QAAQG,MAAM,CAACqC,KAAK,CAACD;YACvCE,aAAa,CAACF;gBACZ,IAAIhF,MAAMD,OAAO,EAAE;oBACjBE,QAAQC,GAAG,CAAC3C,MAAM4H,GAAG,CAAC,CAAC,YAAY,EAAEH,MAAM;gBAC7C;YACF;YACAI,aAAa,CAAChB;gBACZ,IAAIpE,MAAMD,OAAO,EAAE;oBACjBE,QAAQC,GAAG,CAAC3C,MAAMO,IAAI,CAAC,CAAC,OAAO,EAAEsG,KAAK,GAAG,CAAC;gBAC5C;YACF;YACAiB,WAAW,CAACjB,MAAMkB;gBAChB,IAAItF,MAAMD,OAAO,EAAE;oBACjBE,QAAQC,GAAG,CAAC3C,MAAMK,KAAK,CAAC,CAAC,OAAO,EAAEwG,KAAK,UAAU,CAAC;gBACpD;YACF;YACAmB,SAAS,CAAC1G;gBACRzB,MAAM,CAAC,OAAO,EAAEyB,IAAIK,OAAO,EAAE;YAC/B;QACF;QAGA,MAAMoG,SAAS,MAAMd,OAAOgB,MAAM,CAChC;YACEC,WAAWf,QAAQG,EAAE;YACrBW,QAAQ9E;YACR6D;QACF,GACAO;QAIF,IAAI;YACF,MAAMN,OAAOkB,aAAa,CAAChB,QAAQG,EAAE;QACvC,EAAE,OAAM,CAER;QAEA,IAAIS,OAAOnI,OAAO,EAAE;YAClB8C,QAAQC,GAAG;YACX/C,QAAQ,CAAC,eAAe,EAAEyD,WAAW,uBAAuB,CAAC;YAC7D,IAAIZ,MAAMD,OAAO,IAAIuF,OAAOK,UAAU,GAAG,GAAG;gBAC1CrI,KAAK,CAAC,aAAa,EAAEgI,OAAOK,UAAU,EAAE;YAC1C;QACF,OAAO;YACLvI,MAAM,CAAC,eAAe,EAAEwD,WAAW,SAAS,EAAE0E,OAAOlI,KAAK,IAAI,iBAAiB;QACjF;IACF,EAAE,OAAOyB,KAAK;QACZ,MAAMK,UAAUL,eAAeE,QAAQF,IAAIK,OAAO,GAAGC,OAAON;QAC5D,IAAIK,QAAQ0G,QAAQ,CAAC,uBAAuB;YAC1CxI,MAAM,CAAC,6CAA6C,CAAC;YACrD6C,QAAQC,GAAG,CAAC3C,MAAMI,MAAM,CAAC;QAC3B,OAAO;YACLP,MAAM,CAAC,8BAA8B,EAAE8B,SAAS;QAClD;IACF;AACF;AAEA,eAAeW;IACbI,QAAQC,GAAG,CACT,GAAGpC,KAAK,SAAS,GAAG,EAAEF,MAAM,oEAAoE;IAElGqC,QAAQC,GAAG;IACXD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG;IACXD,QAAQC,GAAG,CAACxC,KAAK;IACjBuC,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG;IACXD,QAAQC,GAAG,CAACxC,KAAK;IACjBuC,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG;IACXD,QAAQC,GAAG,CAACxC,KAAK;IACjBuC,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG;IACXD,QAAQC,GAAG,CAACxC,KAAK;IACjBuC,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEvC,OAAO,2BAA2B,8CAA8C,CAAC;IAExFsC,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEvC,OAAO,8BAA8B,+CAA+C,CAAC;IAE5FsC,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEvC,OAAO,yBAAyB,mDAAmD,CAAC;IAE3FsC,QAAQC,GAAG,CACT,CAAC,EAAE,EAAEvC,OAAO,8BAA8B,4CAA4C,CAAC;IAEzFsC,QAAQC,GAAG;IACXD,QAAQC,GAAG,CAACxC,KAAK;IACjBuC,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG,CAAC;IACZD,QAAQC,GAAG;IACXD,QAAQC,GAAG,CAAC;AACd"}